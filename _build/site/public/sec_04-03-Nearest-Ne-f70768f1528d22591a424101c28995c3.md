# Nearest Neighbor Analysis


## The 2 Distance-based Approaches

```{figure} ./resources/w05-img/three_strategies_for_point_pattern_2b.png
:label:
:alt:
:align: center

Everyone look for the nearest neighbor vs. everyone draw a series of search buffer (radius).
```


## 4 examples of point distribution: Clustered or Random?

```{figure} ./resources/w05-img/four_demo_points.png
:label:
:alt:
:align: center

4 types of points in North Singapore: Woodlands Regional Centre, Woodlands West, and Woodgrove, with an area of $2 \text{km} \times 2 \text{km}$
```


### Nearest Neighbor Analysis Calculation Process: In A Nut Shell

- Identifying nearest neighbors for every point
- Record the nearest neighbor distances
- Calculate the .red[mean value]
    - observed average nearest neighbor distance ($D_O$)
- The average nearest neighbor distance:
    - short: the points are close to each other
    - long: the points are far from each other

].column[
    <img src="resources/w05-img/simulate_nna.gif" width="95%">
]]

---
class: left, middle

.split-40[.column[
### Nearest Neighbor Analysis
How short is short enough to be considered as "clustered"?

Let's use the .red[Monte Carlo Simulation] approach to test the .red[difference] between the .red[observed] point pattern and a large number of random patterns generated under the .red[CSR assumption].
].column[
<img src="resources/w05-img/mean_nearest_negihbor_4cases_b.png" width="95%">
]]

---
class: left, middle

.split-40[.column[
### Monte Carlo Simulation

- .red[Area size has to match the study area].
    - Area size will affect the distance between points.
- .red[The number of points has to match the dataset].
    - Within the same area, more points (higher density) will lead to lower nearest neighbor distances.

].column[
<img src="resources/w05-img/monte_carlo_point_pattern.gif" width="95%">
]]

---
class: left, middle

.split-50[.column[
### Statistical Testing

- After simulating random for M times, we will get M measurement of mean nearest neighbor distances.
- The frequency distribution of the N values would form a normal distribution.
- The range where the normal distribution is located represent the "random (CSR)" under the specific area and # point setting.

].column[
<img src="resources/w05-img/drawing_normal_testing_0.png" width="100%">
]]

---
class: left, middle

.split-50[.column[
### Statistical Testing

(1) If the observed value is far from the random, we found a clear evidence that the observed pattern is different from random.
- either .red[clustered or dispersed]

].column[
<img src="resources/w05-img/drawing_normal_testing_1.png" width="100%">
]]

---
class: left, middle

.split-50[.column[
### Statistical Testing

(2) If the observed value fall within the random range, then, we did not find any evidence to prove that the observed pattern is different from random.
- cannot reject the null hypothesis
- .red[we have no choice but to believe it is random]

].column[
<img src="resources/w05-img/drawing_normal_testing_2.png" width="100%">
]]

---
class: left, middle

.split-50[.column[
### Statistical Testing

(3) If the observed fall at the edge of the normal distribution
- check .red[p-value] and your confidence level setting.

.underline[p-value: the probability of being wrong to reject null hypothesis]

.footnote-left[see [ESRI "What is a z-score? What is a p-value?"](https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-statistics/what-is-a-z-score-what-is-a-p-value.htm) for more details]

].column[
<img src="resources/w05-img/drawing_normal_testing_3.png" width="100%">
]]

???
Let's say we set the confidence level to 99%, meaning we are willing to accept a 1% risk of being wrong (incorrectly rejecting the null hypothesis, H0).
If the obtained p-value is 3%, which is higher than our acceptable risk, we cannot reject H0.

---
class: center, top

.headnote.small.title-font.bold[How the observed mean compared with 10k CSR simulations mean results?]

<img src="resources/w05-img/nna_compare_hist.png" width="90%">

.footnote.small.title-font.bold[Monte Carlo Simulation]

???
The grey area indicates the mean nearest neighbor distance of the 10k random pattern.

---
class: left, middle
.split-30[.column[
### Z-test approach

Z-test is another option for testing the significant levels of how observed nearest neighbor distance ($\bar{D}_O$) is different from the 'expected' average nearest neighbor distance ($\bar{D}_E$) under CSR.
.smaller[See [ESRI](https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-statistics/h-how-average-nearest-neighbor-distance-spatial-st.htm) for detail.]

].column[
The nearest neighbor distance ratio:
$$
\text{ANN} = \frac{\bar{D}_O}{\bar{D}_E}
$$
If the index ($\text{ANN}$) is less than 1, the pattern exhibits clustering.
If the index is greater than 1, the trend is toward dispersion.

The expected mean distance could be calculated using the number of point (n) and the study area (A):
$$
\bar{D}_E = \frac{0.5}{\sqrt{n/A}}
$$

The z-score can then be calculated using $\bar{D}_O$ and $\bar{D}_E$:
$$
z = \frac{\bar{D}_O - \bar{D}_E}{SE}
$$

The z-score and p-value for this statistic are sensitive to changes in the study area or changes to the Area parameter. For this reason, only compare z-score and p-value results from this statistic when the study area is fixed.

]]

---
class: left, middle
.split-30[.column[
### Z-test approach

].column[

<img src="resources/w05-img/ztest.png" width="85%">
.footnote-left[see [ESRI "What is a z-score? What is a p-value?"](https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-statistics/what-is-a-z-score-what-is-a-p-value.htm) for more details]
]]


---
class: left, middle

.split-30[.column[
### Summary
#### Nearest Neighbor Analysis (NNA)

].column[

- This approach calculates the average distance of the nearest neighbor for every point.

<br>
- The observed average nearest neighbor distance can be tested using a Monte Carlo Simulation or z-test approaches against the null hypothesis of CSR.

<br>
- The NNA has an assumption that the points being measured are .red[free to locate anywhere within the study area] (for example, there are no barriers, and all cases or features are located independently of one another).

]]
